<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Connection Test - HealthVault ID</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-blue-50 via-purple-50 to-teal-50 min-h-screen p-8">
    
    <div class="max-w-4xl mx-auto">
        <div class="bg-white rounded-3xl p-8 shadow-xl">
            
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-gray-900 mb-2">üîå API Connection Test</h1>
                <p class="text-gray-600">Test your backend API connectivity</p>
                <div class="mt-4 bg-indigo-50 border-2 border-indigo-200 rounded-xl p-4">
                    <p class="text-sm text-indigo-800">
                        <strong>Backend URL:</strong> <code class="bg-indigo-100 px-2 py-1 rounded">https://healthvault-api-f1d6.onrender.com/api</code>
                    </p>
                </div>
            </div>

            <!-- Test Buttons -->
            <div class="space-y-4 mb-8">
                
                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <h3 class="font-bold mb-2">1. Health Check</h3>
                    <button onclick="testHealth()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        <i class="ri-heart-pulse-line mr-2"></i>
                        Test Health Endpoint
                    </button>
                </div>

                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <h3 class="font-bold mb-2">2. Get Patient (Demo ID: HV123456789)</h3>
                    <button onclick="testGetPatient()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        <i class="ri-user-line mr-2"></i>
                        Get Patient Data
                    </button>
                </div>

                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <h3 class="font-bold mb-2">3. Create Test Patient</h3>
                    <button onclick="testCreatePatient()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        <i class="ri-user-add-line mr-2"></i>
                        Create Patient
                    </button>
                </div>

                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <h3 class="font-bold mb-2">4. Get Reports</h3>
                    <button onclick="testGetReports()" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        <i class="ri-file-list-line mr-2"></i>
                        Get Reports
                    </button>
                </div>

                <div class="border-2 border-gray-200 rounded-xl p-4">
                    <h3 class="font-bold mb-2">5. Create Test Report</h3>
                    <button onclick="testCreateReport()" class="bg-pink-500 hover:bg-pink-600 text-white px-6 py-3 rounded-xl font-semibold transition">
                        <i class="ri-file-add-line mr-2"></i>
                        Create Report
                    </button>
                </div>

            </div>

            <!-- Results -->
            <div class="border-t-2 border-gray-200 pt-6">
                <h2 class="text-xl font-bold mb-4">üìä Test Results</h2>
                <div id="results" class="bg-gray-50 rounded-xl p-6 min-h-[200px] font-mono text-sm overflow-auto max-h-[500px]">
                    <p class="text-gray-500">Click a test button to see results...</p>
                </div>
            </div>

            <!-- Back Link -->
            <div class="mt-6 text-center">
                <a href="index.html" class="text-indigo-600 hover:underline font-semibold">
                    <i class="ri-arrow-left-line mr-2"></i>
                    Back to Home
                </a>
            </div>

        </div>
    </div>

    <!-- Include API Service -->
    <script src="api-service.js"></script>

    <script>
        function displayResult(title, result) {
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            
            const statusClass = result.success ? 'text-green-600' : 'text-red-600';
            const statusIcon = result.success ? '‚úÖ' : '‚ùå';
            
            const html = `
                <div class="mb-4 p-4 border-2 ${result.success ? 'border-green-200 bg-green-50' : 'border-red-200 bg-red-50'} rounded-lg">
                    <div class="${statusClass} font-bold mb-2">
                        ${statusIcon} ${title} - ${timestamp}
                    </div>
                    <div class="text-gray-700">
                        <strong>Status:</strong> ${result.success ? 'Success' : 'Failed'}<br>
                        ${result.success 
                            ? '<strong>Data:</strong><br>' + JSON.stringify(result.data, null, 2)
                            : '<strong>Error:</strong> ' + result.error
                        }
                    </div>
                </div>
            `;
            
            resultsDiv.innerHTML = html + resultsDiv.innerHTML;
        }

        async function testHealth() {
            console.log('Testing health endpoint...');
            const result = await api.checkHealth();
            displayResult('Health Check', result);
        }

        async function testGetPatient() {
            console.log('Testing get patient...');
            const result = await api.getPatient('HV123456789');
            displayResult('Get Patient', result);
        }

        async function testCreatePatient() {
            console.log('Testing create patient...');
            
            const randomId = 'HV' + Math.floor(Math.random() * 1000000000);
            
            const patientData = {
                healthId: randomId,
                name: 'Test Patient ' + Date.now(),
                age: 30,
                gender: 'Male',
                bloodGroup: 'O+',
                height: 175,
                weight: 70,
                email: 'test@example.com',
                phone: '+1234567890'
            };
            
            const result = await api.createPatient(patientData);
            displayResult('Create Patient', result);
        }

        async function testGetReports() {
            console.log('Testing get reports...');
            const result = await api.getReports('HV123456789');
            displayResult('Get Reports', result);
        }

        async function testCreateReport() {
            console.log('Testing create report...');
            
            const reportData = {
                healthId: 'HV123456789',
                reportName: 'Test Report ' + Date.now(),
                hospitalName: 'Test Hospital',
                doctorName: 'Dr. Test',
                reportDate: new Date().toISOString().split('T')[0],
                reportType: 'Blood Test',
                status: 'normal',
                notes: 'This is a test report'
            };
            
            const result = await api.createReport(reportData);
            displayResult('Create Report', result);
        }

        // Auto test health on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('API Test Page Loaded');
            console.log('Backend URL:', api.baseUrl);
            
            // Automatically test health endpoint
            setTimeout(() => {
                testHealth();
            }, 1000);
        });
    </script>

</body>
</html>
